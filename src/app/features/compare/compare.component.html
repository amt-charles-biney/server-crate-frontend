<ng-container *ngIf="singleProduct | async"></ng-container>
<main class="max-w-[1239px] mx-auto mt-[66px]">
  <header class="flex justify-between mb-6">
    <h2 class="text-2xl font-bold">Compare Servers</h2>
    <button (click)="clearSelections()" class="text-sm text-red-600 underline">
      Clear selections
    </button>
  </header>
  <section class="flex">
    <div class="flex flex-col border">
      <div class="row h-[241px]">
        <p>Products</p>
      </div>
      <div class="row h-[147px]">
        <p>Description</p>
      </div>
      <div class="row h-[39px]">
        <p>Case</p>
      </div>
      <div class="row h-[39px]">
        <p>Graphics Card</p>
      </div>
      <div class="row h-[39px]">
        <p>Motherboard</p>
      </div>
      <div class="row h-[39px]">
        <p>RAM</p>
      </div>
      <div class="row h-[39px]">
        <p>Storage</p>
      </div>
      <div class="row h-[39px] !border-b-0">
        <p>Operating System</p>
      </div>
      <div class="row h-[39px] !border-b-0">
      </div>
    </div>
    <div class="flex gap-[73px] ml-[17px] overflow-auto myScroll">
      <ng-container *ngIf="allProducts | async as allProducts">
        <ng-container *ngIf="productsToCompare | async as productsToCompare">
          @for (product of products; track product) {
          <div class="flex flex-col">
            <div class="py-3 px-2 product">
              <p class="font-bold">{{ product.productName }}</p>
            </div>
            <div class="relative h-[180px] product !rounded-2xl mt-3">
              <img
                [ngSrc]="product.coverImage | cloudinaryUrl"
                class="max-w-full max-h-full object-contain"
                width="469"
                height="180"
                priority
                [alt]="'image of ' + product.productName"
              />
              <button
                class="absolute top-2 right-3"
                (click)="addToWishlist(product.productId)"
              >
                <img src="/assets/heart.svg" alt="" />
              </button>
              <p class="absolute bottom-2 right-3 font-[500] text-sm">
                {{ product.productPrice | currency }}
              </p>
            </div>
            <div
              class="border-b w-[469px] flex flex-col justify-center items-center h-[147px]"
            >
              <p>{{ product.description }}</p>
            </div>
            <div
              class="border-b w-[469px] flex flex-col justify-center items-center h-[39px]"
            >
              <p>{{ product.productCase }}</p>
            </div>
            <div
              class="border-b w-[469px] flex flex-col justify-center items-center h-[39px]"
            >
              <p>{{ product.options["graphics"] || "Not available" }}</p>
            </div>
            <div
              class="border-b w-[469px] flex flex-col justify-center items-center h-[39px]"
            >
              <p>{{ product.options["motherboard"] || "Not available" }}</p>
            </div>
            <div
              class="border-b w-[469px] flex flex-col justify-center items-center h-[39px]"
            >
              <p>{{ product.options["ram"] || "Not available" }}</p>
            </div>
            <div
              class="border-b w-[469px] flex flex-col justify-center items-center h-[39px]"
            >
              <p>{{ product.options["storage"] || "Not available" }}</p>
            </div>
            <div
              class="border-b w-[469px] flex flex-col justify-center items-center h-[39px]"
            >
              <p>
                {{ product.options["operating systems"] || "Not available" }}
              </p>
            </div>
            <button (click)="goToConfiguration(product.productId)" class="w-full my-2 rounded-xl text-xl text-white py-4 px-[72px] bg-figma-green">
              Configure
            </button>
          </div>
          }
          <ng-container *ngIf="products.length < 5">
          <div class="flex flex-col gap-3">
            <div class="product ">
                <form [formGroup]="productList">
                  <div class="relative">
                    <label for="comparison">
                      <input
                        id="comparison"
                        class="w-full border-[1.5px] placeholder:text-figma-gray outline-figma-green px-4 py-2 rounded-md"
                        type="text"
                        placeholder="Select a product for comparison"
                        #trigger="matAutocompleteTrigger"
                        formControlName="product"
                        [matAutocomplete]="productsAuto"
                      />
                      <img
                        class="absolute top-3 right-[10px] transition-transform duration-300 w-4 h-4"
                        src="/assets/chevron-down.svg"
                        alt="expand"
                      />
                    </label>
                  </div>
                  <mat-autocomplete
                    (optionSelected)="onProductSelect($event)"
                    [hideSingleSelectionIndicator]="true"
                    [displayWith]="displayFn"
                    #productsAuto="matAutocomplete"
                  >
                    <mat-option [value]="option" class="relative" *ngFor="let option of filteredOptions | async">
                      {{ option.name }}
                    </mat-option>
                  </mat-autocomplete>
                </form>
                <!-- <p class="font-bold">{{ product.productName }}</p> -->
              </div>
              <div
              class="flex flex-col justify-center items-center flex-1 p-1 w-full rounded-3xl"
              >
              <button (click)="openPanel($event)">
                <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-20 h-20 text-gray-200"
                >
                <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
                />
              </svg>
            </button>
            <p class="font-inter text-lg text-gray-300 text-center">
              Add a product
            </p>
          </div>
        </div>
      </ng-container>
        </ng-container>
      </ng-container>
    </div>
  </section>
</main>
